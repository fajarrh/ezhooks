import{objectSpread2 as e,typeof as n,slicedToArray as t,defineProperty as r,asyncToGenerator as a,regeneratorRuntime as o}from"./_virtual/_rollupPluginBabelHelpers.js";import i from"react";import{incDec as c,remove as u,setArray as s,set as l,empty as f,format as d,pick as p}from"./utils/index.js";var y=function(e){if(Array.isArray(e))return[];var n;return null!==(n={string:"",number:0}[e])&&void 0!==n?n:""},v=function(n,r){switch(r.type){case"SET":for(var a=0,o=Object.entries(r.payload);a<o.length;a++){var i=t(o[a],2),f=i[0],d=i[1];l(n,d,f)}return e({},n);case"AR":var p=r.payload,y=p.key,v=p.data,b=p.position;return s(n,v,y,b),e({},n);case"RA":var g=r.payload,m=g.key,j=g.condition;return u(n,m,j),e({},n);case"II":for(var k=0,h=Object.entries(r.payload);k<h.length;k++){var O=t(h[k],2),A=O[0],S=O[1];c(n,S,A,"inc")}return e({},n);case"DI":for(var I=0,V=Object.entries(r.payload);I<V.length;I++){var x=t(V[I],2),R=x[0],w=x[1];c(n,w,R,"dec")}return e({},n);default:return e({},n)}},b=function(c){var u=new AbortController,s=e({defaultValue:{}},c),l="object"===n(s.defaultValue)?Object.assign({},s.defaultValue):s.defaultValue,b=i.useState(void 0),g=t(b,2),m=g[0],j=g[1],k=i.useReducer(v,l),h=t(k,2),O=h[0],A=h[1],S=i.useState(!1),I=t(S,2),V=I[0],x=I[1],R=i.useMemo((function(){return Object.entries(O).filter((function(e){var n=t(e,1)[0];return!Object.keys(s.defaultValue).includes(n)}))}),[O,s.defaultValue]),w=function(e){if(s.format&&!f(s.format))for(var n=0,r=Object.entries(e);n<r.length;n++){var a=t(r[n],2),o=a[0],i=a[1];d(e,s.format,i,o,O)}A({type:"SET",payload:e})},E=i.useCallback((function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start",a=t instanceof File?t:"object"===n(t)?Object.assign({},t):t;A({type:"AR",payload:{key:e,data:a,position:r}})}),[]),C=i.useCallback((function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"start",i="function"==typeof t?t({}):t,c=i instanceof File?i:"object"===n(i)?Object.assign({},i):i,u=e.split(".").reduce((function(e,n){var t=e[n];return t||[]}),O),s=-1;-1===(s=i instanceof File&&a.length||"object"===n(i)&&a.length?(u||[]).findIndex((function(e){return a.every((function(n){return e[n]===c[n]}))})):(u||[]).findIndex((function(e){return e===i})))?A({type:"AR",payload:{key:e,data:c,position:o}}):w(r({},"".concat(e,".").concat(s),"function"==typeof t?t(u[s]):c))}),[]),T=i.useCallback((function(e){A({type:"RA",payload:{key:e,condition:arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0}})}),[]),D=function(){var n=a(o().mark((function n(t){var r,a,i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e({scenario:m,service:function(e){},onSuccess:function(e){},onError:function(e){},onAlways:function(){}},t),n.prev=1,x(!0),a={ctr:u,scenario:r.scenario,data:_,keys:P},n.next=6,r.service(a);case 6:i=n.sent,r.onSuccess(i),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(1),r.onError(n.t0);case 13:return n.prev=13,x(!1),r.onAlways(),n.finish(13);case 17:case"end":return n.stop()}}),n,null,[[1,10,13,17]])})));return function(e){return n.apply(this,arguments)}}(),F=i.useCallback((function(e,n){return e.split(".").reduce((function(e,n){var t=e[n];return t||""}),O)||n||""}),[O]),P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return e&&!c.scenario?[]:"string"==typeof e&&e in c.scenario?[{name:e,keys:c.scenario[e]}]:"boolean"==typeof e&&e?Object.entries(c.scenario).map((function(e){var n=t(e,2);return{name:n[0],keys:n[1]}})):[{name:"default",keys:Object.keys(O||{})}]},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return"boolean"==typeof e&&e?O:"string"==typeof e&&null!=c&&c.scenario&&e in c.scenario?p(O,c.scenario[e]||[]):O};return{scenario:m,processing:V,data:_,cancel:function(){u.abort()},setData:w,increment:function(e){A({type:"II",payload:e})},decrement:function(e){A({type:"DI",payload:e})},add:E,remove:T,value:F,reset:function(){Object.assign(s.defaultValue,Object.fromEntries(R.map((function(e){var n=t(e,2),r=n[0],a=n[1];return[r,y(a)]})))),A({type:"SET",payload:s.defaultValue})},send:D,keys:P,setScenario:function(e){j(e)},upsert:C}};export{b as default};
