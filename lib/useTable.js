import{objectSpread2 as a,objectWithoutProperties as r,slicedToArray as e,defineProperty as t,toConsumableArray as n,typeof as o,asyncToGenerator as p,regeneratorRuntime as s}from"./_virtual/_rollupPluginBabelHelpers.js";import{useRef as i,useState as u,useReducer as c,useMemo as d,useCallback as l,useEffect as g}from"react";import{pick as m,omit as f,debounce as y,skipParams as P}from"./utils/index.js";var v=["params"],h=["params"],b=["sort","pagination"],E=function(r,e){switch(e.type){case"SET":return a(a({},r),"function"==typeof e.payload?e.payload(r):e.payload);case"CLEAR":return{};case"CLEAR_EXCEPT":return m(r,e.payload);case"CLEAR_ONLY":return f(r,e.payload);case"REMOVE":return f(r,[e.payload]);default:return r}},B=function(r,e){switch(e.type){case"set":return n(e.payload);case"update":var t=r[e.index];return r[e.index]="object"===o(e.value)?a(a({},t),e.value):e.value,n(r);case"add":return"number"==typeof e.position?r.splice(e.position,0,e.value):"start"===e.position?r.unshift(e.value):r.push(e.value),n(r);case"remove":return r.splice(r.findIndex(e.condition),1),n(r);default:return n(r)}},x={selector:function(a){return[]},total:function(a){return 0},service:function(a){},replaceUrl:!1,disabledOnDidMount:!1,sort:{params:{order:"order",orderBy:"orderBy"},order:"desc",orderBy:"id"},deps:[],pagination:{params:{page:"page",perPage:"perPage"},startPage:1,perPage:10,perPageOptions:[5,10,15,25],from:function(a,r,e,t){return(r-1+(0===t?1:0))*e+(0===a?0:0===t?1:t)},to:function(a,r,e,t){return Math.min(a,(r+(0===t?1:0))*e)},lastPage:function(a,r){return Math.max(0,Math.ceil(a/r))},disableFirst:function(a,r,e){return 0!==a&&r===e},disableLast:function(a,r,e){return 0!==a&&r===e}}},C=function(o){var C=new AbortController,L=a(a({},m(x,["deps"])),m(o,["deps"])),w=x.sort,R=w.params,O=r(w,v),S=x.pagination,A=S.params,T=r(S,h),k=r(x,b),M=a(a({},k),f(o||{},["pagination","sort"])),_=!!o.replaceUrl,j=a(a({},O),{},{params:a(a({},R),o&&o.sort&&o.sort.params)},f(o&&o.sort||{},["params"])),U=a(a({},T),{},{params:a(a({},A),o&&o.pagination&&o.pagination.params)},f(o&&o.pagination||{},["params"])),F=new URL(window.location.href),D=new URLSearchParams(F.search),I=f(D,[j.params.order,j.params.orderBy,U.params.page,U.params.perPage]),N=0===U.startPage?1:0,V=i(!M.disabledOnDidMount),X=u(!1),Y=e(X,2),q=Y[0],G=Y[1],H=u(!1),Q=e(H,2),W=Q[0],z=Q[1],J=c(E,_?I:{}),K=e(J,2),Z=K[0],$=K[1],aa=c(B,[]),ra=e(aa,2),ea=ra[0],ta=ra[1],na=u(t(t({},j.params.order,_&&D.get(j.params.order)||j.order),j.params.orderBy,_&&D.get(j.params.orderBy)||j.orderBy)),oa=e(na,2),pa=oa[0],sa=oa[1],ia=u(0),ua=e(ia,2),ca=ua[0],da=ua[1],la=u(t(t({},U.params.page,+(_&&D.get(U.params.page)||U.startPage)),U.params.perPage,+(_&&D.get(U.params.perPage)||U.perPage))),ga=e(la,2),ma=ga[0],fa=ga[1],ya=d((function(){return{from:U.from(ca,ma[U.params.page],ma[U.params.perPage],U.startPage),to:U.to(ca,ma[U.params.page],ma[U.params.perPage],U.startPage),lastPage:U.lastPage(ca,ma[U.params.perPage])}}),[ca,ma,F]),Pa=ya.from,va=ya.to,ha=ya.lastPage,ba=l((function(r){$({type:"SET",payload:r}),fa((function(r){return a(a({},r),{},t({},U.params.page,U.startPage))}))}),[Z]),Ea=function(){var r=p(s().mark((function r(){var e,t,n;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,G(!0),e=a({},P(a(a(a({},Z),ma),pa))),t={ctr:C,params:e},r.next=6,o.service(t);case 6:n=r.sent,da(M.total(n)),ta({type:"set",payload:M.selector(n)}),_&&(F.search=new URLSearchParams(e).toString(),window.history.replaceState(null,"",F.href)),r.next=14;break;case 12:r.prev=12,r.t0=r.catch(0);case 14:return r.prev=14,G(!1),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[0,12,14,17]])})));return function(){return r.apply(this,arguments)}}();g((function(){return V.current?y(Ea,200)():V.current=!0,function(){C.abort()}}),[Z,pa,ma,W].concat(n(L.deps)));var Ba=d((function(){return ea}),[ea]),xa=ma[U.params.page]+N,Ca=U.perPageOptions,La=ma[U.params.perPage],wa="".concat(Pa,"â€“").concat(va," of ").concat(ca>0?ca:"more than ".concat(va)),Ra=pa[j.params.order],Oa=pa[j.params.orderBy];return{isEmpty:0===ea.length,loading:q,total:ca,data:Ba,order:Ra,orderBy:Oa,update:function(a,r){if(ea.length>0){var e=ea.findIndex(a);e>-1&&ta({type:"update",index:e,value:r})}},add:function(a){ta({type:"add",value:a,position:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"end"})},destroy:function(a){ta({type:"remove",condition:a})},query:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return a?void 0===Z[a]&&void 0!==r?r:Z[a]:Z},setTotal:function(a){da(a)},setQuery:ba,onSort:function(a){sa((function(r){return t(t({},j.params.orderBy,a),j.params.order,r[j.params.orderBy]===a&&"desc"===r[j.params.order]?"asc":"desc")}))},reload:function(a){z((function(a){return!a}))},clear:function(a){var r,e,n={},o="CLEAR";(null==a||null===(r=a.except)||void 0===r?void 0:r.length)>0?(o="CLEAR_EXCEPT",n=a.except):(null==a||null===(e=a.only)||void 0===e?void 0:e.length)>0&&(o="CLEAR_ONLY",n=a.only),$({type:o,payload:n}),fa(t(t({},U.params.page,U.startPage),U.params.perPage,U.perPage)),sa(t(t({},j.params.orderBy,j.orderBy),j.params.order,j.order)),z((function(a){return!a}))},remove:function(r){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];$({type:"REMOVE",payload:r}),e&&fa((function(r){return a(a({},r),{},t({},U.params.page,U.startPage))}))},has:function(a){return Z.hasOwnProperty(a)},pagination:{total:ca,page:xa,from:Pa,to:va,lastPage:ha,perPageOptions:Ca,perPage:La,text:wa,setPage:function(r){y((function(){fa((function(e){return a(a({},e),{},t({},U.params.page,r))})),$({type:"SET",payload:t({},U.params.page,r)})}),60)()},setPerPage:function(r){y((function(){fa((function(e){return a(a({},e),{},t({},U.params.perPage,r))})),$({type:"SET",payload:t({},U.params.perPage,r)})}),60)()},nextButton:function(){return{disabled:U.disableLast(ca,ma[U.params.page],ha),onClick:function(r){ca>0&&ma[U.params.page]!==ha&&fa((function(r){return a(a({},r),{},t({},U.params.page,r[U.params.page]+1))}))}}},backButton:function(){return{disabled:U.disableFirst(ca,ma[U.params.page],U.startPage),onClick:function(r){0!==ca&&ma[U.params.page]>U.startPage&&fa((function(r){return a(a({},r),{},t({},U.params.page,r[U.params.page]-1))}))}}},firstButton:function(){return{disabled:U.disableFirst(ca,ma[U.params.page],U.startPage),onClick:function(r){ca>0&&ma[U.params.page]>U.startPage&&fa((function(r){return a(a({},r),{},t({},U.params.page,U.startPage-N))}))}}},lastButton:function(r){return{disabled:U.disableLast(ca,ma[U.params.page],ha),onClick:function(r){ca>0&&ma[U.params.page]!==ha&&fa((function(r){return a(a({},r),{},t({},U.params.page,ha-N))}))}}},onPerPageChange:function(r){fa((function(e){return a(a({},e),{},t({},U.params.perPage,+r.target.value))}))}}}};export{C as default};
